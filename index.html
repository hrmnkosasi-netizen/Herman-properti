<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Herman Kosasi - Property Advisor</title>
    <meta
      name="description"
      content="Temukan properti impian di PIK, Jakarta Utara dan sekitarnya bersama Herman Kosasi."
    />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.css"
    />

    <style>
      /* =========================================
         1. CSS UTAMA & VARIABEL
         ========================================= */
      :root { --primary-yellow: #FFCC00; --dark-text: #1a1a1a; --gray-text: #666; --wa-green: #25D366; --bg-color: #f8f9fa; --danger-red: #ff4757; }
      * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
      body { font-family: 'Poppins', sans-serif; margin: 0; padding: 0; background-color: var(--bg-color); color: var(--dark-text); padding-bottom: 80px; }

      /* HEADER & HOME STYLES */
      .main-header-yellow { background-color: var(--primary-yellow); padding: 30px 20px 60px 20px; color: var(--dark-text); border-bottom-left-radius: 35px; border-bottom-right-radius: 35px; position: relative; z-index: 1; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
      .header-top-row { display: flex; justify-content: space-between; position: absolute; top: 20px; left: 0; width: 100%; padding: 0 20px; z-index: 5; pointer-events: none; }
      .calendar-icon-btn { pointer-events: auto; font-size: 22px; color: var(--dark-text); background: rgba(255,255,255,0.5); width: 40px; height: 40px; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; border: none; margin-left: auto; z-index: 20; }
      .calendar-icon-btn:active { transform: scale(0.9); background: white; }
      
      .header-content-flex { display: flex; flex-direction: column; align-items: center; text-align: center; gap: 15px; margin-top: 10px; }
      .profile-pic-header { width: 130px; height: 130px; border-radius: 50%; border: 4px solid white; object-fit: cover; box-shadow: 0 4px 10px rgba(0,0,0,0.1); background: #fff; }
      .agent-name-header { font-size: 22px; font-weight: 800; margin: 0; text-transform: uppercase; }
      .agent-details-header { font-size: 14px; font-weight: 600; }
      .agent-job { display: inline-block; background: rgba(255,255,255,0.6); padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 700; margin-top: 5px; }
      
      .header-contact-links { display: flex; justify-content: center; gap: 10px; margin-top: 10px; position: relative; z-index: 20; }
      .contact-icon-btn { background: rgba(255,255,255,0.8); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; color: var(--dark-text); font-size: 18px; transition: 0.2s; cursor: pointer; }
      .contact-icon-btn:hover { transform: scale(1.1); background: white; }

      .stats-container-overlap { margin-top: -40px; position: relative; z-index: 2; padding: 0 15px; }
      .stats-row { display: flex; justify-content: center; gap: 10px; }
      .stat-box { background: white; flex: 1; padding: 12px 5px; border-radius: 12px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.2s; }
      .stat-box:active { transform: scale(0.95); background-color: #f9f9f9; }
      .stat-num { font-weight: 800; font-size: 20px; display: block; }
      .stat-label { font-size: 10px; color: var(--gray-text); font-weight: 600; text-transform: uppercase;}

      .section-box { background: white; margin: 20px 15px; padding: 20px; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.02); }
      .about-section { border-left: 4px solid var(--primary-yellow); }
      .about-title { font-size: 16px; font-weight: 700; margin-bottom: 10px; }
      .about-text { font-size: 13px; line-height: 1.6; color: #444; text-align: justify; }
      .feature-grid { padding: 0 15px; margin-bottom: 25px; display: grid; gap: 15px; }
      .vendor-banner { background: linear-gradient(135deg, #222, #444); color: white; padding: 20px; border-radius: 15px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 5px 15px rgba(0,0,0,0.1); cursor: pointer;}
      .vendor-btn { background: var(--primary-yellow); color: black; text-decoration: none; padding: 8px 15px; border-radius: 20px; font-size: 12px; font-weight: 700; white-space: nowrap; cursor: pointer; border: none;}
      .buyer-request-banner { background: white; border: 2px dashed #007bff; padding: 15px; border-radius: 15px; text-align: center; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.05); transition: 0.2s; }
      .buyer-request-banner:active { transform: scale(0.98); background: #f0f8ff; }
      .buyer-icon-circle { width: 40px; height: 40px; background: #e3f2fd; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #007bff; font-size: 18px; }
      .buyer-text { text-align: left; }
      .buyer-text strong { display: block; font-size: 13px; color: #333; }
      .buyer-text small { font-size: 11px; color: #666; }

      /* =========================================
         3. KPR, TESTI, FAQ
         ========================================= */
      .kpr-box { background: white; padding: 0; border-radius: 15px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); overflow: hidden; border-top: 4px solid var(--primary-yellow); }
      .kpr-tabs { display: flex; background: #eee; }
      .kpr-tab-btn { flex: 1; padding: 15px; border: none; background: none; font-weight: 700; font-size: 13px; cursor: pointer; color: #666; transition: 0.3s; border-bottom: 3px solid transparent; }
      .kpr-tab-btn.active { background: white; color: var(--dark-text); border-bottom-color: var(--primary-yellow); }
      .kpr-content { padding: 20px; display: none; }
      .kpr-content.active { display: block; animation: fadeIn 0.3s; }
      .kpr-header { font-size: 15px; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
      .kpr-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 15px; }
      .kpr-input-group label { font-size: 11px; color: #555; display: block; margin-bottom: 4px; font-weight: 600; }
      .kpr-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 13px; background: #fcfcfc; transition: 0.2s; }
      .kpr-input:focus { border-color: var(--primary-yellow); outline: none; }
      .btn-calc { width: 100%; background: var(--dark-text); color: white; border: none; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; }
      .kpr-result-container { margin-top: 15px; background: #f8f9fa; border-radius: 10px; border: 1px dashed #ccc; padding: 15px; display: none; }
      .kpr-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 12px; color: #555; border-bottom: 1px solid #eee; padding-bottom: 5px; }
      .kpr-row:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
      .kpr-val-bold { font-weight: 700; color: #333; }
      .kpr-total-cicilan { text-align: center; margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd; }
      .kpr-total-cicilan strong { font-size: 20px; color: var(--primary-yellow); text-shadow: 0 1px 1px rgba(0,0,0,0.1); }
      .btn-share-kpr { display:flex; align-items:center; justify-content:center; gap:6px; width:100%; margin-top:15px; background:white; color:var(--wa-green); border:1px solid var(--wa-green); padding:8px; border-radius:8px; font-weight:600; font-size:12px; cursor:pointer; transition:0.2s; }
      .btn-share-kpr:active { background: #e8f5e9; transform: scale(0.98); }

      .testi-section { padding: 0 15px; margin-top: 30px; margin-bottom: 20px; }
      .testi-header { display: flex; align-items: center; gap: 8px; margin-bottom: 15px; font-weight: 700; font-size: 16px; }
      .testi-scroll { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
      .testi-card { min-width: 260px; background: white; padding: 15px; border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.03); border: 1px solid #eee; }
      .testi-user { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
      .t-avatar { width: 35px; height: 35px; background: #ddd; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #555; font-size: 14px; }
      .t-info h4 { margin: 0; font-size: 13px; }
      .t-stars { color: var(--primary-yellow); font-size: 10px; }
      .t-text { font-size: 12px; color: #555; line-height: 1.5; font-style: italic; }

      .faq-section { padding: 0 15px; margin-bottom: 30px; }
      .faq-header { display: flex; align-items: center; gap: 8px; font-weight: 700; font-size: 16px; margin-bottom: 15px; }
      .faq-box { background: white; border-radius: 15px; box-shadow: 0 3px 10px rgba(0,0,0,0.03); overflow: hidden; }
      .faq-item { border-bottom: 1px solid #eee; }
      .faq-item:last-child { border-bottom: none; }
      .faq-question { width: 100%; background: none; border: none; padding: 15px; text-align: left; font-weight: 600; font-size: 13px; color: var(--dark-text); display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-family: inherit; }
      .faq-question i { color: #bbb; transition: transform 0.3s; }
      .faq-answer { display: none; padding: 0 15px 15px 15px; font-size: 12px; line-height: 1.6; color: #666; }
      .faq-item.active .faq-answer { display: block; animation: fadeIn 0.3s; }
      .faq-item.active .faq-question { color: var(--primary-yellow); background: #fcfcfc; }
      .faq-item.active .faq-question i { transform: rotate(180deg); color: var(--primary-yellow); }

      /* =========================================
         4. PAGE SYSTEM & SEARCH
         ========================================= */
      .view-section { display: none; animation: fadeInView 0.3s; }
      .view-section.active { display: block; }
      @keyframes fadeInView { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

      .page-simple-header { padding: 20px 15px; background: white; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.03); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 90; }
      .page-title { font-size: 18px; font-weight: 800; color: var(--dark-text); margin: 0; }
      .page-subtitle { font-size: 11px; color: #666; margin-top: 2px; }

      .search-filter-area { padding: 0 15px; margin-bottom: 20px; scroll-margin-top: 20px; }
      .search-sort-row { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
      .search-box { position: relative; flex: 2; }
      .search-input { width: 100%; padding: 12px 15px 12px 40px; border: none; border-radius: 12px; background: white; outline: none; font-family: inherit; box-shadow: 0 2px 5px rgba(0,0,0,0.05); font-size: 13px;}
      .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #aaa; }
      .btn-reset-filter { background: white; color: var(--danger-red); border: 1px solid #eee; width: 40px; height: 40px; border-radius: 12px; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; align-items: center; justify-content: center; font-size: 16px; transition: 0.2s; }
      .btn-reset-filter:active { transform: scale(0.95); background: #f9f9f9; }
      .sort-box { flex: 1; position: relative; }
      .sort-select { width: 100%; height: 40px; padding: 0 10px; border: none; border-radius: 12px; background: white; font-family: inherit; font-size: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); outline: none; }
      .price-slider-container { padding: 10px 5px 25px 5px; }
      .price-label-row { display: flex; justify-content: space-between; font-size: 11px; font-weight: 700; color: var(--dark-text); margin-bottom: 10px; }
      .noUi-target { border: none; box-shadow: none; background: #eee; height: 6px; }
      .noUi-connect { background: var(--primary-yellow); }
      .noUi-handle { border: 2px solid var(--primary-yellow); background: white; border-radius: 50%; width: 20px; height: 20px; right: -10px !important; top: -8px !important; box-shadow: 0 2px 5px rgba(0,0,0,0.2); cursor: grab; }
      .noUi-handle:before, .noUi-handle:after { display: none; }
      .advanced-filter-row { display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
      .filter-container { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
      .filter-btn { border: none; background: white; padding: 8px 18px; border-radius: 20px; font-size: 13px; font-weight: 600; color: var(--gray-text); cursor: pointer; white-space: nowrap; flex-shrink: 0; box-shadow: 0 2px 5px rgba(0,0,0,0.02); transition: 0.2s;}
      .filter-btn.active { background: var(--primary-yellow); color: var(--dark-text); box-shadow: 0 4px 10px rgba(255, 204, 0, 0.3); }

      .listing-container { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 0 15px; margin-bottom: 30px; }
      .property-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.05); display: flex; flex-direction: column; cursor: pointer; transition: transform 0.2s; position: relative; }
      .property-card:active { transform: scale(0.98); }
      .card-image-wrapper { position: relative; height: 140px; background: #eee;}
      .card-img { width: 100%; height: 100%; object-fit: cover; }
      .badge-top-left { position: absolute; top: 8px; left: 8px; display: flex; gap: 5px; }
      .status-tag { padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; text-transform: uppercase; color: white; }
      .status-tag.jual { background: var(--primary-yellow); color: black; }
      .status-tag.sewa { background: #007bff; }
      .hot-deal-badge { background: var(--danger-red); color: white; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 700; }
      .status-tag.baru { background: #00c853; color: white; margin-right: 5px; box-shadow: 0 2px 5px rgba(0,200,83, 0.3); animation: pulseBadge 2s infinite; }
      @keyframes pulseBadge { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
      
      /* Tombol di atas kartu */
      .btn-wishlist { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.8); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; z-index: 10; font-size: 16px; color: #ccc; transition: 0.2s; }
      .btn-wishlist.active { color: #ff4757; background: white; transform: scale(1.1); }
      
      .btn-compare { position: absolute; top: 45px; right: 8px; background: rgba(255,255,255,0.8); border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; z-index: 10; font-size: 14px; color: #666; transition: 0.2s; }
      .btn-compare.active { background: var(--dark-text); color: var(--primary-yellow); transform: scale(1.1); }

      .card-body { padding: 12px; flex: 1; display: flex; flex-direction: column; justify-content: space-between; }
      .price-tag { font-size: 16px; font-weight: 800; color: var(--dark-text); margin-bottom: 4px; }
      .price-dropped { color: #d63031 !important; display: flex; align-items: center; gap: 5px; }
      .price-old-strikethrough { text-decoration: line-through; color: #999; font-size: 10px; margin-bottom: -2px; font-weight: 600; }
      .prop-name { font-size: 12px; margin-bottom: 8px; line-height: 1.4; color: #333; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; height: 34px; font-weight: 600;}
      .location-row { font-size: 11px; color: #888; margin-bottom: 8px; display: flex; align-items: center; gap: 4px; }
      .specs-row { display: flex; justify-content: space-between; color: var(--gray-text); font-size: 11px; background: #f9f9f9; padding: 5px; border-radius: 6px; }
      .spec-item { display: flex; align-items: center; gap: 3px; }
      .spec-item i { color: var(--primary-yellow); font-size: 12px; }
      .card-btn { margin-top: 10px; background: #eee; color: #333; font-size: 11px; text-align: center; padding: 8px; border-radius: 6px; font-weight: 600; }
      .no-result { grid-column: span 2; text-align: center; padding: 30px; color: #999; font-size: 14px; display: none; }
      .loading-placeholder { grid-column: span 2; text-align: center; padding: 50px; color: #999; font-size: 14px; }

      /* =========================================
         5. MODALS UTAMA (DETAIL, BOOKING, ETC)
         ========================================= */
      .detail-modal {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: white;
          z-index: 9999; /* Z-Index Sangat Tinggi */
          transform: translateY(100%);
          transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
          display: flex;
          flex-direction: column;
      }
      .detail-modal.active { transform: translateY(0); }

      .detail-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: white; border-bottom: 1px solid #eee; flex-shrink: 0; }
      .back-btn { color: #333; font-size: 20px; background: #f5f5f5; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; }

      .detail-body-scroll {
          flex: 1;
          overflow-y: auto;
          padding-bottom: 20px;
      }

      .detail-gallery { height: 350px; width: 100%; display: flex; overflow-x: auto; scroll-snap-type: x mandatory; background: #eee; flex-shrink: 0; }
      .gallery-img { min-width: 100%; height: 100%; object-fit: cover; scroll-snap-align: center; }

      .detail-content { padding: 20px; background: white; }

      .d-price { font-size: 26px; font-weight: 800; color: var(--dark-text); margin-bottom: 5px; }
      .d-title { font-size: 18px; color: #333; font-weight: 600; line-height: 1.4; margin-bottom: 10px; }
      .specs-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; border-top: 1px solid #eee; border-bottom: 1px solid #eee; padding: 20px 0; }
      .sg-item { text-align: center; display: flex; flex-direction: column; align-items: center; justify-content: center; }
      .sg-icon { font-size: 18px; color: var(--primary-yellow); margin-bottom: 6px; display: block;}
      .sg-val { font-weight: 700; font-size: 13px; display: block; color: #333; line-height: 1.2;}
      .sg-label { font-size: 10px; color: #888; margin-top: 2px; }
      .desc-box h3, .facility-box h3, .video-box h3 { font-size: 16px; font-weight: 700; margin-bottom: 10px; }
      .desc-text { font-size: 14px; color: #555; line-height: 1.8; margin-bottom: 25px; white-space: pre-line; }
      .facility-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 30px; }
      .fac-item { display: flex; align-items: center; gap: 10px; font-size: 13px; color: #444; }
      .fac-item i { color: var(--wa-green); }
      .video-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 10px; margin-bottom: 25px; background: black;}
      .video-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

      /* FIXED FOOTER */
      .detail-footer {
          background: white;
          padding: 15px 20px;
          box-shadow: 0 -5px 15px rgba(0,0,0,0.05);
          display: grid;
          grid-template-columns: 1fr 2fr;
          gap: 10px;
          flex-shrink: 0;
          position: relative;
          z-index: 10;
      }

      .btn-booking { background: white; border: 2px solid var(--primary-yellow); color: #d4a000; padding: 12px; border-radius: 10px; font-weight: 700; text-align: center; text-decoration: none; display: flex; justify-content: center; align-items: center; gap: 5px; font-size: 13px; cursor: pointer;}
      .btn-whatsapp { background: var(--wa-green); border: none; color: white; padding: 12px; border-radius: 10px; font-weight: 700; text-align: center; text-decoration: none; display: flex; justify-content: center; align-items: center; gap: 8px; box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3); font-size: 14px;}
      .similar-scroll { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
      .similar-card { min-width: 140px; width: 140px; background: white; border-radius: 10px; overflow: hidden; border: 1px solid #eee; cursor: pointer; display:flex; flex-direction: column; }
      .similar-img { width: 100%; height: 90px; object-fit: cover; }
      .similar-body { padding: 8px; }
      .similar-price { font-size: 12px; font-weight: 700; color: var(--dark-text); }
      .similar-title { font-size: 10px; line-height: 1.3; color: #555; margin-top: 3px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

      /* OTHERS */
      .calendar-bg { background-color: var(--primary-yellow); min-height: 100vh; display: flex; flex-direction: column; }
      .calendar-header-title { pointer-events: auto; font-size: 16px; font-weight: 700; color: #1a1a1a; margin-top: 5px; }
      .calendar-content { padding: 80px 20px 20px 20px; flex: 1; overflow-y: auto; }
      .calendar-card { background: white; padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; border-left: 5px solid #ccc; display: flex; gap: 15px; align-items: center; }
      .cc-left { text-align: center; min-width: 50px; border-right: 1px solid #eee; padding-right: 15px; }
      .cc-date { font-size: 24px; font-weight: 800; color: var(--dark-text); display: block; line-height: 1; }
      .cc-month { font-size: 10px; text-transform: uppercase; font-weight: 700; color: #666; }
      .cc-right { flex: 1; }
      .cc-badge { font-size: 9px; padding: 3px 8px; border-radius: 4px; font-weight: 700; text-transform: uppercase; display: inline-block; margin-bottom: 5px; }
      .cc-badge.internal { background: #eee; color: #555; }
      .cc-badge.umum { background: #007bff; color: white; }
      .cc-title { font-size: 14px; font-weight: 700; margin-bottom: 3px; color: #333; }
      .cc-time { font-size: 11px; color: #666; }

      /* VENDOR SCROLL FIX */
      .vendor-content {
          padding: 80px 20px 40px 20px;
          flex: 1;
          overflow-y: auto;
          background: #f8f9fa;
      }
      .vendor-title { font-size: 20px; font-weight: 800; margin-bottom: 20px; text-align: center; color: #333; }
      .form-divider { margin: 20px 0; border-top: 1px dashed #ccc; position: relative; }
      .form-divider span { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: #f8f9fa; padding: 0 10px; font-size: 10px; color: #888; text-transform: uppercase; font-weight: bold; }
      .form-row-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
      .form-group { margin-bottom: 15px; }
      .form-group label { display: block; font-size: 11px; font-weight: 600; margin-bottom: 5px; color: #555; }
      .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 13px; background: white; }
      .form-control:disabled { background: #eee; color: #999; cursor: not-allowed; }
      .error-msg { color: var(--danger-red); font-size: 11px; margin-top: 5px; display: none; }
      .form-control:focus { border-color: var(--primary-yellow); outline: none; background: #fffbeb; }
      .btn-submit-wa { width: 100%; background: var(--wa-green); color: white; padding: 15px; border: none; border-radius: 10px; font-weight: 700; font-size: 15px; cursor: pointer; margin-top: 10px; box-shadow: 0 5px 15px rgba(37, 211, 102, 0.3); display: flex; justify-content: center; align-items: center; gap: 8px; }

      .compare-floating-bar { position: fixed; bottom: 85px; left: 50%; transform: translateX(-50%) translateY(200%); background: var(--dark-text); color: white; padding: 12px 20px; border-radius: 30px; box-shadow: 0 5px 20px rgba(0,0,0,0.3); z-index: 2500; display: flex; align-items: center; gap: 15px; transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); width: 90%; max-width: 400px; justify-content: space-between; }
      .compare-floating-bar.show { transform: translateX(-50%) translateY(0); }
      .btn-open-compare { background: var(--primary-yellow); color: var(--dark-text); border: none; padding: 5px 15px; border-radius: 20px; font-weight: 700; font-size: 12px; cursor: pointer; }
      .compare-table-wrapper { overflow-x: auto; margin-top: 15px; padding-bottom: 20px; }
      .compare-table { width: 100%; border-collapse: collapse; min-width: 300px; }

      /* COMPARE TABLE STYLING (YELLOW THEME) */
      .compare-table td { border-bottom: 1px solid #ffeaa7; }
      .compare-table tr:first-child td { background: white; border-bottom: 4px solid var(--primary-yellow); vertical-align: bottom; padding-bottom: 15px; }
      .compare-header-img { width: 80px; height: 60px; object-fit: cover; border-radius: 8px; display: block; margin-bottom: 5px; }
      .compare-label { background-color: #fffbeb; color: var(--dark-text); font-weight: 700; width: 35%; border-right: 2px solid white; vertical-align: middle; padding: 10px; font-size: 12px; }
      .compare-val { background-color: white; color: #333; text-align: center; width: 32.5%; vertical-align: middle; padding: 10px; font-size: 12px; }
      .btn-remove-compare { background: var(--danger-red); color: white; border: none; width: 24px; height: 24px; font-size: 12px; margin-top: 5px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); border-radius: 50%; cursor: pointer;}

      /* COMPARE MODAL HEADER CUSTOMIZATION */
      #compareModal .detail-header { background: var(--primary-yellow); box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
      #compareModal .calendar-header-title { color: var(--dark-text) !important; }
      #compareModal .back-btn { background: white !important; color: var(--dark-text) !important; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

      .history-container { padding: 0 15px; margin-bottom: 40px; margin-top: 20px; border-top: 4px solid #f1f1f1; padding-top: 20px; display: none; }
      .history-header { font-size: 16px; font-weight: 700; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }

      .lightbox-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 10000; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
      .lightbox-modal.active { opacity: 1; pointer-events: auto; }
      .lightbox-content-wrapper { position: relative; width: 100%; max-width: 600px; text-align: center; }
      .lightbox-img { max-width: 100%; max-height: 80vh; border-radius: 5px; box-shadow: 0 0 20px rgba(0,0,0,0.5); object-fit: contain; }
      .lightbox-close-btn { position: absolute; top: -50px; right: 20px; background: rgba(255,255,255,0.2); color: white; width: 40px; height: 40px; border-radius: 50%; border: none; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
      .lightbox-hint { color: #aaa; font-size: 12px; margin-top: 10px; }

      .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid #eee; display: flex; justify-content: space-around; align-items: center; padding: 10px 0; z-index: 2900; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
      @media(min-width: 768px) { .bottom-nav { display: none; } }
      .nav-item { display: flex; flex-direction: column; align-items: center; text-decoration: none; color: #999; font-size: 10px; font-weight: 600; gap: 4px; transition: 0.2s; cursor: pointer; }
      .nav-item i { font-size: 18px; margin-bottom: 2px; }
      .nav-item.active { color: var(--dark-text); }
      .nav-item.wa-highlight { color: var(--wa-green); font-weight: 700; }

      .btn-scroll-top { position: fixed; bottom: 85px; right: 20px; background: var(--dark-text); color: var(--primary-yellow); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; border: none; cursor: pointer; z-index: 2800; box-shadow: 0 4px 10px rgba(0,0,0,0.2); opacity: 0; visibility: hidden; transition: 0.3s; }
      .btn-scroll-top.show { opacity: 1; visibility: visible; transform: translateY(0); }
      .btn-scroll-top:active { transform: scale(0.9); }

      .btn-kirim-fav { background: var(--wa-green) !important; color: white !important; border: none !important; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3) !important; }
      .btn-map-pill { display: inline-flex; align-items: center; gap: 5px; background: #e3f2fd; color: #007bff; text-decoration: none; padding: 4px 10px; border-radius: 15px; font-size: 10px; font-weight: 700; margin-left: 8px; transition: 0.2s; }

      /* CSS POSTER GENERATOR (HIDDEN) */
      #posterTemplate {
          position: fixed;
          left: -9999px; /* Hide off-screen */
          top: 0;
          width: 450px;
          background: white;
          z-index: 9999;
          font-family: 'Poppins', sans-serif;
      }
      .poster-container { padding-bottom: 20px; border: 1px solid #ddd; }
      .poster-header { background: var(--primary-yellow); padding: 20px; display: flex; align-items: center; gap: 15px; border-bottom-left-radius: 30px; border-bottom-right-radius: 30px; }
      .poster-agent-img { width: 70px; height: 70px; border-radius: 50%; border: 3px solid white; object-fit: cover; }
      .poster-agent-info h2 { font-size: 18px; font-weight: 800; margin: 0; text-transform: uppercase; color: var(--dark-text); }
      .poster-agent-info p { font-size: 12px; margin: 0; font-weight: 600; }
      .poster-main-img-wrapper { width: 100%; height: 350px; margin-top: -20px; padding: 0 15px; position: relative; z-index: 2; }
      .poster-main-img { width: 100%; height: 100%; object-fit: cover; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.15); border: 2px solid white; background: #eee; }
      .poster-details { padding: 15px 20px; text-align: center; }
      .poster-price { font-size: 28px; font-weight: 800; color: var(--dark-text); margin-bottom: 5px; background: #fcfcfc; display: inline-block; padding: 5px 15px; border-radius: 10px; border: 1px dashed #ccc; }
      .poster-title { font-size: 16px; font-weight: 700; color: #333; margin-bottom: 5px; line-height: 1.4; }
      .poster-loc { font-size: 12px; color: #666; margin-bottom: 15px; }
      .poster-specs { display: flex; justify-content: center; gap: 15px; margin-bottom: 20px; background: #f8f9fa; padding: 10px; border-radius: 10px; }
      .poster-spec-item { display: flex; flex-direction: column; align-items: center; font-size: 12px; font-weight: 700; color: #444; }
      .poster-spec-item i { color: var(--primary-yellow); font-size: 16px; margin-bottom: 3px; }
      .poster-footer { background: #1a1a1a; color: white; padding: 15px; text-align: center; margin: 0 15px; border-radius: 10px; }
      .poster-footer h3 { margin: 0; font-size: 14px; font-weight: 700; color: var(--primary-yellow); }
      .poster-footer p { margin: 3px 0 0 0; font-size: 11px; }

      /* NEW: NEARBY TAGS */
      .nearby-container { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:20px; }
      .nearby-tag { display:flex; align-items:center; gap:6px; background:#f8f9fa; padding:6px 12px; border-radius:20px; font-size:11px; color:#555; border:1px solid #eee; }
      .nearby-tag i { color:var(--primary-yellow); }

      /* =========================================
   6. RESPONSIVE DESKTOP (WEB MODE)
   ========================================= */
@media (min-width: 769px) {
  
  /* 1. Container Utama & Background */
  body {
    background-color: #eef2f5; /* Latar belakang abu muda agar konten menonjol */
    padding-bottom: 0;
  }

  /* Bungkus konten agar tidak terlalu lebar (Max 1200px) */
  .view-section {
    max-width: 1200px;
    margin: 20px auto;
    background: white;
    min-height: 90vh;
    box-shadow: 0 0 20px rgba(0,0,0,0.05);
    border-radius: 20px;
    position: relative;
    overflow: hidden; /* Agar radius sudut terlihat */
  }

  /* 2. Header / Hero Section */
  .main-header-yellow {
    padding: 40px 60px 80px 60px;
    border-radius: 0 0 50px 50px; /* Lengkungan lebih halus */
  }

  .header-content-flex {
    flex-direction: row; /* Foto di kiri, Teks di kanan */
    text-align: left;
    gap: 30px;
    justify-content: center;
  }

  .header-info {
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .header-contact-links {
    justify-content: flex-start; /* Icon kontak rata kiri */
  }
  
  .profile-pic-header {
    width: 160px;
    height: 160px;
    border-width: 6px;
  }

  /* 3. Stats Box (Listing/Jual/Sewa) */
  .stats-container-overlap {
    max-width: 800px;
    margin: -50px auto 30px auto; /* Tengah secara horizontal */
  }
  
  .stat-box {
    padding: 20px; /* Lebih besar di desktop */
  }

  /* 4. Grid Listing Properti (Jadikan 4 atau 5 Kolom) */
  .listing-container {
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); /* Otomatis menyesuaikan */
    gap: 25px;
    padding: 0 30px;
  }
  
  .card-image-wrapper {
    height: 160px; /* Gambar tidak terlalu tinggi */
  }

  /* 5. Bagian Pencarian (Search) */
  .search-filter-area {
    padding: 0 30px;
  }
  
  .search-sort-row {
    max-width: 800px;
  }

  /* 6. Layout Dua Kolom untuk Section Info (About, Features) */
  .feature-grid {
    display: grid;
    grid-template-columns: 1fr 1fr; /* Vendor banner & Buyer request sebelahan */
    gap: 20px;
    padding: 0 30px;
  }

  .kpr-box, .testi-section, .faq-section, .section-box {
    margin-left: 30px;
    margin-right: 30px;
  }

  /* 7. Navigasi Desktop (Transformasi Bottom Nav jadi Top Nav) */
  .bottom-nav {
    display: flex !important; /* Paksa muncul */
    position: sticky;
    top: 0;
    bottom: auto;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
    border-top: none;
    border-bottom: 1px solid #eee;
    background: rgba(255,255,255,0.95);
    padding: 15px 40px;
    justify-content: flex-end; /* Menu di kanan */
    gap: 30px;
    z-index: 100;
    backdrop-filter: blur(5px);
  }

  .nav-item {
    flex-direction: row; /* Icon sebelah teks */
    font-size: 14px;
    gap: 8px;
  }
  
  .nav-item i {
    font-size: 16px;
    margin-bottom: 0;
  }

  /* 8. MODAL (Detail, Booking, dll) Menjadi Popup Tengah */
  .detail-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5); /* Backdrop gelap */
    display: flex; /* Flex untuk centering */
    align-items: center;
    justify-content: center;
    transform: translateY(100%); /* Default hidden state logic tetap sama */
    padding: 20px;
    z-index: 9999;
  }

  .detail-modal.active {
    transform: translateY(0); /* Muncul */
  }

  /* Container konten di dalam modal */
  .detail-header, .detail-body-scroll, .detail-footer, .vendor-content, .calendar-content {
    /* Kita butuh wrapper baru sebenarnya, tapi kita hack layoutnya */
    max-width: 500px; /* Lebar popup */
    width: 100%;
    background: white;
  }

  /* Mengakali struktur HTML yang flat untuk efek Popup Card */
  .detail-modal {
    /* Reset flex direction dari column (mobile) ke row/block untuk wrapper */
    flex-direction: column; 
    justify-content: center;
  }

  /* Paksa elemen-elemen modal agar terlihat menyatu sebagai satu kartu */
  .detail-header {
    border-radius: 15px 15px 0 0;
    flex: none;
    width: 500px; /* Samakan lebar */
  }
  
  .detail-body-scroll, .vendor-content, .calendar-content {
    flex: none; /* Jangan stretch */
    height: 60vh; /* Tinggi fix untuk scroll */
    width: 500px;
  }
  
  .detail-footer {
    width: 500px;
    border-radius: 0 0 15px 15px;
  }

  /* Perbaikan Modal Booking (karena strukturnya agak beda) */
  #bookingModal {
    justify-content: center !important; /* Override style inline */
    align-items: center;
  }
  #bookingModal > div {
    width: 400px;
    border-radius: 15px !important;
  }
  
  /* Compare Floating Bar */
  .compare-floating-bar {
    bottom: 30px;
    width: auto;
    min-width: 300px;
  }
}
    </style>
  </head>
  <body>
    <div id="viewHome" class="view-section active">
      <div class="main-header-yellow">
        <div class="header-top-row">
          <button class="calendar-icon-btn" onclick="openCalendar()">
            <i class="far fa-calendar-alt"></i>
          </button>
        </div>

        <div class="header-content-flex">
          <img
            src="https://i.postimg.cc/1tX3mSBc/HERMAN-KOSASI.jpg"
            alt="Herman Kosasi"
            class="profile-pic-header"
            onerror="this.src='https://ui-avatars.com/api/?name=Herman+Kosasi&background=FFFFFF&color=333&size=128&bold=true'"
          />

          <div class="header-info">
            <h1 class="agent-name-header">Herman Kosasi (LOUO)</h1>
            <div class="agent-details-header">
              Brighton Titanium PIK <br />
              <span class="agent-job">Property Advisor</span>
            </div>
            <div class="header-contact-links">
              <a href="mailto:hrmnkosasi@gmail.com" class="contact-icon-btn"
                ><i class="fas fa-envelope"></i
              ></a>
              <a
                href="https://www.brighton.co.id/hermankosasi"
                target="_blank"
                class="contact-icon-btn"
                ><i class="fas fa-globe"></i
              ></a>
              <a
                href="https://wa.me/6285760035568"
                target="_blank"
                class="contact-icon-btn"
                ><i class="fab fa-whatsapp"></i
              ></a>
            </div>
          </div>
        </div>
      </div>

      <div class="stats-container-overlap">
        <div class="stats-row">
          <div
            class="stat-box"
            onclick="navClick(null, 'search'); clickStatBaru('all')"
          >
            <span class="stat-num" id="countAll">0</span
            ><span class="stat-label">Listing</span>
          </div>
          <div
            class="stat-box"
            onclick="navClick(null, 'search'); clickStatBaru('jual')"
          >
            <span class="stat-num" id="countJual">0</span
            ><span class="stat-label">Jual</span>
          </div>
          <div
            class="stat-box"
            onclick="navClick(null, 'search'); clickStatBaru('sewa')"
          >
            <span class="stat-num" id="countSewa">0</span
            ><span class="stat-label">Sewa</span>
          </div>
        </div>
      </div>

      <div class="section-box about-section">
        <div class="about-title">
          <i class="fas fa-user-tie" style="color: var(--primary-yellow);"></i>
          Tentang Saya
        </div>
        <div class="about-text">
          Professional Property Advisor dengan trade area Jakarta dan Sekitar.
          Saya siap membantu Anda menemukan properti impian dengan pelayanan
          terbaik dan transparan.
        </div>
      </div>

      <div class="feature-grid">
        <div class="vendor-banner">
          <div>
            <h3
              style="margin: 0; font-size: 16px; color: var(--primary-yellow);"
            >
              Punya Properti?
            </h3>
            <p style="margin: 3px 0 0 0; font-size: 12px; opacity: 0.8;">
              Titip Jual/Sewa di sini, cepat laku!
            </p>
          </div>
          <button onclick="openVendorModal()" class="vendor-btn">
            Titip Jual/Sewa <i class="fas fa-arrow-right"></i>
          </button>
        </div>

        <div class="buyer-request-banner" onclick="openBuyerModal()">
          <div class="buyer-icon-circle"><i class="fas fa-search"></i></div>
          <div class="buyer-text">
            <strong>Bingung Cari Properti?</strong>
            <small>Klik di sini, biar saya yang carikan!</small>
          </div>
        </div>
      </div>

      <div class="history-container" id="historySection">
        <div class="history-header">
          <i class="fas fa-history" style="color: #888;"></i> Terakhir Dilihat
        </div>
        <div class="similar-scroll" id="historyList"></div>
      </div>

      <div style="padding: 0 15px; margin-bottom: 30px;">
        <div class="kpr-box">
          <div class="kpr-tabs">
            <button
              class="kpr-tab-btn active"
              onclick="switchKprTab('cicilan')"
            >
              Hitung Cicilan
            </button>
            <button class="kpr-tab-btn" onclick="switchKprTab('budget')">
              Hitung Budget
            </button>
            <button class="kpr-tab-btn" onclick="switchKprTab('pajak')">
              Biaya Pajak
            </button>
          </div>

          <div id="tabCicilan" class="kpr-content active">
            <div class="kpr-header">
              <i
                class="fas fa-calculator"
                style="color: var(--primary-yellow);"
              ></i>
              Simulasi Cicilan KPR
            </div>
            <div class="kpr-form-grid">
              <div class="kpr-input-group">
                <label>Harga Properti (Rp)</label
                ><input
                  type="text"
                  id="kprHarga"
                  value="1.500.000.000"
                  class="kpr-input"
                  onkeyup="formatRupiahInput(this)"
                />
              </div>
              <div class="kpr-input-group">
                <label>DP (%)</label
                ><input type="number" id="kprDP" value="20" class="kpr-input" />
              </div>
              <div class="kpr-input-group">
                <label>Bunga (%)</label
                ><input
                  type="number"
                  id="kprBunga"
                  value="5"
                  class="kpr-input"
                />
              </div>
              <div class="kpr-input-group">
                <label>Tenor (Thn)</label
                ><input
                  type="number"
                  id="kprTahun"
                  value="15"
                  class="kpr-input"
                />
              </div>
            </div>
            <button onclick="hitungKPR()" class="btn-calc">
              Hitung Angsuran
            </button>
            <div id="hasilKPR" class="kpr-result-container">
              <div class="kpr-row">
                <span>Pokok Pinjaman:</span
                ><span class="kpr-val-bold" id="outPokok">Rp 0</span>
              </div>
              <div class="kpr-row">
                <span>Estimasi Gaji Min.:</span
                ><span class="kpr-val-bold" id="outGaji">Rp 0</span>
              </div>
              <div class="kpr-total-cicilan">
                <span>Angsuran per Bulan:</span
                ><strong id="outCicilan">Rp 0</strong>
              </div>
              <button class="btn-share-kpr" onclick="shareKPRToWA()">
                <i class="fab fa-whatsapp"></i> Kirim Hasil ini ke WA
              </button>
            </div>
          </div>

          <div id="tabBudget" class="kpr-content">
            <div class="kpr-header">
              <i
                class="fas fa-wallet"
                style="color: var(--primary-yellow);"
              ></i>
              Simulasi Budget Kemampuan
            </div>
            <div class="form-group" style="margin-bottom:10px;">
              <label style="font-size:11px; font-weight:600;"
                >Gaji Bulanan (Rp)</label
              ><input
                type="text"
                id="budGaji"
                value="15.000.000"
                class="kpr-input"
                onkeyup="formatRupiahInput(this)"
              />
            </div>
            <div class="kpr-form-grid">
              <div class="kpr-input-group">
                <label>Max Cicilan dr Gaji (%)</label
                ><input
                  type="number"
                  id="budPersen"
                  value="30"
                  class="kpr-input"
                  placeholder="Standar bank 30%"
                />
              </div>
              <div class="kpr-input-group">
                <label>DP yg Dimiliki (Rp)</label
                ><input
                  type="text"
                  id="budDP"
                  value="300.000.000"
                  class="kpr-input"
                  onkeyup="formatRupiahInput(this)"
                />
              </div>
              <div class="kpr-input-group">
                <label>Bunga (%)</label
                ><input
                  type="number"
                  id="budBunga"
                  value="5"
                  class="kpr-input"
                />
              </div>
              <div class="kpr-input-group">
                <label>Tenor (Thn)</label
                ><input
                  type="number"
                  id="budTahun"
                  value="15"
                  class="kpr-input"
                />
              </div>
            </div>
            <button
              onclick="hitungBudgetKPR()"
              class="btn-calc"
              style="background: var(--primary-yellow); color: black;"
            >
              Hitung Maksimal Harga
            </button>
            <div
              id="hasilBudget"
              class="kpr-result-container"
              style="border-color: var(--primary-yellow);"
            >
              <div class="kpr-row">
                <span>Kemampuan Cicilan:</span
                ><span class="kpr-val-bold" id="outBudCicilan">Rp 0</span>
                /bulan
              </div>
              <div class="kpr-row">
                <span>Maksimal Pinjaman Bank:</span
                ><span class="kpr-val-bold" id="outBudPinjaman">Rp 0</span>
              </div>
              <div class="kpr-total-cicilan">
                <span>Harga Properti Maksimal:</span
                ><strong id="outBudMaxHarga" style="color:var(--dark-text)"
                  >Rp 0</strong
                >
              </div>
            </div>
          </div>

          <div id="tabPajak" class="kpr-content">
            <div class="kpr-header">
              <i
                class="fas fa-file-invoice-dollar"
                style="color: var(--primary-yellow);"
              ></i>
              Estimasi Biaya Awal (Pajak & Legal)
            </div>
            <div class="kpr-form-grid">
              <div class="kpr-input-group" style="grid-column: span 2;">
                <label>Harga Transaksi (Rp)</label>
                <input
                  type="text"
                  id="pajakHarga"
                  value="1.500.000.000"
                  class="kpr-input"
                  onkeyup="formatRupiahInput(this)"
                />
              </div>
              <div class="kpr-input-group">
                <label
                  >NPOPTKP (Rp)
                  <i
                    class="fas fa-info-circle"
                    title="Nilai Tidak Kena Pajak (Jkt: 80jt, Bodetabek beda)"
                  ></i
                ></label>
                <input
                  type="text"
                  id="pajakNPOPTKP"
                  value="60.000.000"
                  class="kpr-input"
                  onkeyup="formatRupiahInput(this)"
                />
              </div>
              <div class="kpr-input-group">
                <label>Est. Biaya Notaris (%)</label>
                <input
                  type="number"
                  id="pajakPersenNotaris"
                  value="2"
                  class="kpr-input"
                />
              </div>
            </div>
            <button
              onclick="hitungPajak()"
              class="btn-calc"
              style="background: #444;"
            >
              Hitung Estimasi Biaya
            </button>

            <div
              id="hasilPajak"
              class="kpr-result-container"
              style="display:none;"
            >
              <div class="kpr-row">
                <span>BPHTB (5%):</span
                ><span class="kpr-val-bold" id="outBPHTB">Rp 0</span>
              </div>
              <div class="kpr-row">
                <span>Est. Notaris/Legal:</span
                ><span class="kpr-val-bold" id="outNotaris">Rp 0</span>
              </div>
              <div class="kpr-total-cicilan">
                <span style="font-size:10px; font-weight:normal;"
                  >Total Biaya Tambahan:</span
                ><br />
                <strong id="outTotalPajak" style="color:#d63031">Rp 0</strong>
              </div>
              <p
                style="font-size:10px; color:#666; text-align:center; margin:5px 0 0 0; font-style:italic;"
              >
                *Belum termasuk biaya KPR bank & asuransi.
              </p>
            </div>
          </div>
        </div>
      </div>

      <div class="testi-section">
        <div class="testi-header">
          <i class="fas fa-star" style="color: var(--primary-yellow);"></i> Apa
          Kata Klien?
        </div>
        <div class="testi-scroll">
          <div class="testi-card">
            <div class="testi-user">
              <div class="t-avatar">B</div>
              <div class="t-info">
                <h4>Bpk. Budi Santoso</h4>
                <div class="t-stars"></div>
              </div>
            </div>
            <div class="t-text">
              "Pak Herman sangat membantu saya mencari ruko di Kelapa Gading.
              Proses nego cepat. Sukses terus!"
            </div>
          </div>
          <div class="testi-card">
            <div class="testi-user">
              <div class="t-avatar">S</div>
              <div class="t-info">
                <h4>Ibu Siska</h4>
                <div class="t-stars"></div>
              </div>
            </div>
            <div class="t-text">
              "Titip jual rumah di Pak Herman langsung laku dalam 2 bulan.
              Sangat recommended agent!"
            </div>
          </div>
        </div>
      </div>

      <div class="faq-section">
        <div class="faq-header">
          <i
            class="fas fa-question-circle"
            style="color: var(--primary-yellow);"
          ></i>
          Pertanyaan Umum
        </div>
        <div class="faq-box">
          <div class="faq-item">
            <button class="faq-question" onclick="toggleFaq(this)">
              Apa syarat pengajuan KPR? <i class="fas fa-chevron-down"></i>
            </button>
            <div class="faq-answer">
              Umumnya: KTP, NPWP, Slip Gaji 3 bulan terakhir, dan Surat Nikah
              (jika ada).
            </div>
          </div>
          <div class="faq-item">
            <button class="faq-question" onclick="toggleFaq(this)">
              Berapa biaya selain harga rumah?
              <i class="fas fa-chevron-down"></i>
            </button>
            <div class="faq-answer">Biaya BPHTB, Notaris, dan Balik Nama.</div>
          </div>
          <div class="faq-item">
            <button class="faq-question" onclick="toggleFaq(this)">
              Bagaimana cara titip jual? <i class="fas fa-chevron-down"></i>
            </button>
            <div class="faq-answer">
              Klik tombol "Titip Jual/Sewa" di atas dan isi formulir.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="viewSearch" class="view-section">
      <div class="page-simple-header">
        <div>
          <h2 class="page-title">Cari Properti</h2>
          <div class="page-subtitle">Temukan properti impian Anda</div>
        </div>
        <div style="font-size: 24px; color: var(--primary-yellow);">
          <i class="fas fa-search-location"></i>
        </div>
      </div>

      <div class="search-filter-area" id="filterArea">
        <div class="search-sort-row">
          <div class="search-box">
            <i class="fas fa-search search-icon"></i
            ><input
              type="text"
              id="searchInput"
              class="search-input"
              onkeyup="applyAllFilters()"
              placeholder="Cari lokasi / nama..."
            />
          </div>
          <button
            onclick="resetAllFilters()"
            class="btn-reset-filter"
            title="Reset Filter"
          >
            <i class="fas fa-sync-alt"></i>
          </button>
          <div class="sort-box">
            <select
              id="sortSelect"
              class="sort-select"
              onchange="sortListings()"
            >
              <option value="newest"> Terbaru</option>
              <option value="price-high"> Termahal</option>
              <option value="price-low"> Termurah</option>
              <option value="oldest"> Terlama</option>
            </select>
          </div>
        </div>

        <div class="price-slider-container">
          <div class="price-label-row">
            <span id="price-min-label">Rp 0</span>
            <span id="price-max-label">Rp Max</span>
          </div>
          <div id="priceSlider"></div>
        </div>

        <div class="advanced-filter-row">
          <div class="sort-box" style="flex: 1; min-width: 100px;">
            <select
              id="typeFilter"
              class="sort-select"
              onchange="applyAllFilters()"
              style="font-size: 12px;"
            >
              <option value="all">Semua Tipe</option>
              <option value="rumah">Rumah</option>
              <option value="ruko">Ruko</option>
              <option value="apartemen">Apartemen</option>
              <option value="tanah">Tanah/Kavling</option>
              <option value="gudang">Gudang</option>
            </select>
          </div>
          <div class="sort-box" style="flex: 1; min-width: 80px;">
            <select
              id="ktFilter"
              class="sort-select"
              onchange="applyAllFilters()"
              style="font-size: 12px;"
            >
              <option value="0">K.Tidur (Semua)</option>
              <option value="1">1+ KT</option>
              <option value="2">2+ KT</option>
              <option value="3">3+ KT</option>
              <option value="4">4+ KT</option>
              <option value="5">5+ KT</option>
            </select>
          </div>
          <div class="sort-box" style="flex: 1; min-width: 90px;">
            <select
              id="suratFilter"
              class="sort-select"
              onchange="applyAllFilters()"
              style="font-size: 12px;"
            >
              <option value="all">Sertifikat</option>
              <option value="shm">SHM</option>
              <option value="hgb">HGB</option>
              <option value="ppjb">PPJB</option>
            </select>
          </div>
          <div class="sort-box" style="flex: 1; min-width: 90px;">
            <select
              id="furnishFilter"
              class="sort-select"
              onchange="applyAllFilters()"
              style="font-size: 12px;"
            >
              <option value="all">Furnish</option>
              <option value="full">Full</option>
              <option value="semi">Semi</option>
              <option value="kosong">Kosong</option>
            </select>
          </div>
        </div>

        <div class="filter-container">
          <button class="filter-btn active" onclick="clickStatBaru('all')">
            Semua
          </button>
          <button class="filter-btn" onclick="clickStatBaru('jual')">
            Dijual
          </button>
          <button class="filter-btn" onclick="clickStatBaru('sewa')">
            Disewa
          </button>
          <button class="filter-btn" onclick="clickStatBaru('hot')">
             Hot
          </button>
        </div>
      </div>

      <div class="listing-container" id="listingContainer">
        <div class="loading-placeholder">
          <i class="fas fa-spinner fa-spin"></i> Sedang memuat properti
          terbaru...
        </div>
      </div>
    </div>

    <div id="viewFav" class="view-section">
      <div class="page-simple-header">
        <div>
          <h2 class="page-title">Favorit Saya</h2>
          <div class="page-subtitle">Daftar properti yang Anda simpan</div>
        </div>
        <div style="font-size: 24px; color: var(--danger-red);">
          <i class="fas fa-heart"></i>
        </div>
      </div>

      <div style="padding: 0 15px; margin-bottom: 20px;">
        <button
          class="btn-share-kpr"
          onclick="shareFavoritesWA()"
          style="background: var(--wa-green); color: white; border:none; padding: 12px;"
        >
          <i class="fab fa-whatsapp"></i> Ajukan Survey Semua Favorit
        </button>
      </div>

      <div class="listing-container" id="favContainer">
        <div class="loading-placeholder">Belum ada properti favorit.</div>
      </div>
    </div>

    <div class="compare-floating-bar" id="compareBar">
      <div style="font-size: 12px; font-weight: 600;">
        <span id="compareCount">0</span>/3 Properti Dipilih
      </div>
      <div style="display:flex; gap:10px;">
        <button class="btn-open-compare" onclick="clearCompare()">Reset</button>
        <button class="btn-open-compare" onclick="openCompareModal()">
          Bandingkan
        </button>
      </div>
    </div>

    <div id="detailModal" class="detail-modal">
      <div class="detail-header">
        <button class="back-btn" onclick="closeDetail()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div style="display:flex; gap:10px;">
          <button class="back-btn" onclick="generatePoster()">
            <i class="fas fa-camera"></i>
          </button>
          <button class="back-btn" onclick="shareListing()">
            <i class="fas fa-share-alt"></i>
          </button>
        </div>
      </div>

      <div class="detail-body-scroll">
        <div class="detail-gallery" id="detailGallery"></div>
        <div class="detail-content">
          <div class="d-price" id="dPrice">Rp 0</div>
          <div class="d-title" id="dTitle">Judul</div>

          <div class="location-row">
            <i
              class="fas fa-map-marker-alt"
              style="color: var(--danger-red);"
            ></i>
            <span id="dLoc">Lokasi</span>
            <a href="#" target="_blank" id="btnSmartMap" class="btn-map-pill"
              ><i class="fas fa-map-marked-alt"></i> Lihat Peta</a
            >
          </div>

          <div class="specs-grid">
            <div class="sg-item">
              <i class="fas fa-bed sg-icon"></i
              ><span class="sg-val" id="dKT">0</span
              ><span class="sg-label">K.Tidur</span>
            </div>
            <div class="sg-item">
              <i class="fas fa-bath sg-icon"></i
              ><span class="sg-val" id="dKM">0</span
              ><span class="sg-label">K.Mandi</span>
            </div>
            <div class="sg-item">
              <i class="fas fa-expand sg-icon"></i
              ><span class="sg-val" id="dLT">0</span
              ><span class="sg-label">LT</span>
            </div>
            <div class="sg-item">
              <i class="fas fa-home sg-icon"></i
              ><span class="sg-val" id="dLB">0</span
              ><span class="sg-label">LB</span>
            </div>
            <div class="sg-item">
              <i class="fas fa-layer-group sg-icon"></i
              ><span class="sg-val" id="dLantai">-</span
              ><span class="sg-label">Lantai</span>
            </div>
            <div class="sg-item">
              <i class="fas fa-compass sg-icon"></i
              ><span class="sg-val" id="dHadap">-</span
              ><span class="sg-label">Hadap</span>
            </div>
            <div class="sg-item">
              <i class="fas fa-bolt sg-icon"></i
              ><span class="sg-val" id="dListrik">-</span
              ><span class="sg-label">Listrik</span>
            </div>
            <div class="sg-item">
              <i class="fas fa-file-contract sg-icon"></i
              ><span class="sg-val" id="dSurat">-</span
              ><span class="sg-label">Surat</span>
            </div>
          </div>

          <div id="nearbySection" style="display:none; margin-bottom:20px;">
            <h3 style="font-size:15px; font-weight:700; margin-bottom:10px;">
              Lokasi Sekitar :
            </h3>
            <div id="nearbyContainer" class="nearby-container"></div>
          </div>

          <div class="video-box" id="videoBox" style="display:none;">
            <h3>Video Tour</h3>
            <div class="video-container" id="videoContainer"></div>
          </div>
          <div class="desc-box">
            <h3>Deskripsi Properti :</h3>
            <div class="desc-text" id="dDesc">Loading...</div>
          </div>
          <div class="facility-box">
            <h3>Fasilitas :</h3>
            <div class="facility-list" id="dFac"></div>
          </div>

          <div
            id="similarSection"
            style="margin-top: 30px; border-top: 1px dashed #ccc; padding-top: 20px; display:none;"
          >
            <h3
              style="font-size: 15px; font-weight: 700; margin-bottom: 15px; color: var(--dark-text);"
            >
              Mungkin Anda Suka
            </h3>
            <div class="similar-scroll" id="similarList"></div>
          </div>
        </div>
      </div>

      <div class="detail-footer">
        <button class="btn-booking" onclick="openBooking()">
          <i class="far fa-calendar-alt"></i> Jadwalkan Survey
        </button>
        <a href="#" id="btnWaDetail" class="btn-whatsapp"
          ><i class="fab fa-whatsapp"></i> WhatsApp</a
        >
      </div>
    </div>

    <div id="posterTemplate">
      <div class="poster-container">
        <div class="poster-header">
          <img
            src="https://i.postimg.cc/1tX3mSBc/HERMAN-KOSASI.jpg"
            class="poster-agent-img"
            crossorigin="anonymous"
          />
          <div class="poster-agent-info">
            <h2>Herman Kosasi</h2>
            <p>Brighton Titanium PIK</p>
          </div>
        </div>
        <div class="poster-main-img-wrapper">
          <img
            id="posterMainImg"
            class="poster-main-img"
            src=""
            crossorigin="anonymous"
          />
        </div>
        <div class="poster-details">
          <div id="posterPrice" class="poster-price">Rp 0</div>
          <div id="posterTitle" class="poster-title">Judul Property</div>
          <div id="posterLoc" class="poster-loc">
            <i class="fas fa-map-marker-alt"></i> Lokasi
          </div>
          <div class="poster-specs">
            <div class="poster-spec-item">
              <i class="fas fa-bed"></i> <span id="posterKT">0</span> KT
            </div>
            <div class="poster-spec-item">
              <i class="fas fa-bath"></i> <span id="posterKM">0</span> KM
            </div>
            <div class="poster-spec-item">
              <i class="fas fa-expand"></i> <span id="posterLT">0</span> LT
            </div>
          </div>
          <div class="poster-footer">
            <h3>HUBUNGI: 0857-6003-5568</h3>
            <p>www.brighton.co.id/hermankosasi</p>
          </div>
        </div>
      </div>
    </div>

    <div
      id="compareModal"
      class="detail-modal"
      style="background: white; z-index: 10001;"
    >
      <div class="detail-header">
        <button
          class="back-btn"
          onclick="closeCompareModal()"
          style="background: white; color: #333;"
        >
          <i class="fas fa-times"></i>
        </button>
        <div class="calendar-header-title">Perbandingan Properti</div>
        <div style="width:35px;"></div>
      </div>
      <div class="calendar-content" style="background: white;">
        <div class="compare-table-wrapper">
          <table class="compare-table" id="compareTableContent"></table>
        </div>
      </div>
    </div>

    <div
      id="bookingModal"
      class="detail-modal"
      style="background: rgba(0,0,0,0.5); z-index: 10002; justify-content: flex-end;"
    >
      <div
        style="background: white; border-radius: 20px 20px 0 0; padding: 20px; transform: translateY(0); animation: slideUp 0.3s;"
      >
        <div
          style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;"
        >
          <h3 style="margin:0; font-size:18px;"> Pilih Jadwal Survey</h3>
          <button
            onclick="closeBooking()"
            style="border:none; background:none; font-size:20px;"
          >
            
          </button>
        </div>
        <div class="form-group">
          <label class="form-group label">Tanggal</label
          ><input
            type="date"
            id="bookDate"
            class="form-control"
            onchange="validateSchedule()"
          />
        </div>
        <div class="form-group">
          <label class="form-group label">Jam</label
          ><select
            id="bookTime"
            class="form-control"
            onchange="validateSchedule()"
          >
            <option value="">Pilih Jam...</option>
            <option value="09:00">09:00 Pagi</option>
            <option value="10:00">10:00 Pagi</option>
            <option value="11:00">11:00 Pagi</option>
            <option value="13:00">01:00 Siang</option>
            <option value="14:00">02:00 Siang</option>
            <option value="16:00">04:00 Sore</option>
          </select>
          <div id="scheduleError" class="error-msg">
            <i class="fas fa-exclamation-circle"></i> Jadwal ini sudah terisi.
            Pilih waktu lain.
          </div>
        </div>
        <div class="form-group">
          <label class="form-group label">Nama Anda</label
          ><input
            type="text"
            id="bookName"
            class="form-control"
            placeholder="Nama Lengkap"
          />
        </div>
        <button
          id="btnSendBooking"
          onclick="sendBookingWA()"
          class="btn-submit-wa"
        >
          Kirim Jadwal via WA
        </button>
      </div>
    </div>

    <div
      id="calendarModal"
      class="detail-modal calendar-bg"
      style="z-index: 10001;"
    >
      <div class="detail-header">
        <button
          class="back-btn"
          onclick="closeCalendar()"
          style="background: rgba(255,255,255,0.3); color: #333;"
        >
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="calendar-header-title">Agenda Survey</div>
        <div style="width:35px;"></div>
      </div>
      <div class="calendar-content" id="calendarList">
        <div style="text-align:center; color:white; margin-top:50px;">
          Memuat jadwal...
        </div>
      </div>
    </div>

    <div
      id="vendorModal"
      class="detail-modal"
      style="background: #f8f9fa; z-index: 10001;"
    >
      <div class="detail-header" style="background: white;">
        <button class="back-btn" onclick="closeVendorModal()">
          <i class="fas fa-arrow-left"></i>
        </button>
        <div class="calendar-header-title">Form Titip Listing</div>
        <div style="width:35px;"></div>
      </div>
      <div class="vendor-content">
        <div
          style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);"
        >
          <div class="form-divider"><span>Data Pemilik</span></div>
          <div class="form-group">
            <label>Nama Lengkap</label
            ><input
              type="text"
              id="vNama"
              class="form-control"
              placeholder="Nama Anda"
            />
          </div>
          <div class="form-group">
            <label>Nomor HP/WA</label
            ><input
              type="text"
              id="vPhone"
              class="form-control"
              placeholder="08xx-xxxx-xxxx"
            />
          </div>
          <div class="form-divider"><span>Data Dasar</span></div>
          <div class="form-row-2">
            <div class="form-group">
              <label>Status</label
              ><select id="vStatus" class="form-control">
                <option value="DIJUAL">DIJUAL</option>
                <option value="DISEWA">DISEWA</option>
              </select>
            </div>
            <div class="form-group">
              <label>Jenis</label
              ><select id="vJenis" class="form-control">
                <option>Rumah</option>
                <option>Ruko</option>
                <option>Apartemen</option>
                <option>Kavling</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Alamat / Lokasi</label
            ><input
              type="text"
              id="vLokasi"
              class="form-control"
              placeholder="Nama Cluster / Jalan / Area"
            />
          </div>
          <div class="form-divider"><span>Spesifikasi</span></div>
          <div class="form-row-2">
            <div class="form-group">
              <label>Luas Tanah (m)</label
              ><input
                type="text"
                id="vLT"
                class="form-control"
                placeholder="120"
              />
            </div>
            <div class="form-group">
              <label>Luas Bangunan (m)</label
              ><input
                type="text"
                id="vLB"
                class="form-control"
                placeholder="200"
              />
            </div>
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label>K. Tidur</label
              ><input
                type="text"
                id="vKT"
                class="form-control"
                placeholder="3+1"
              />
            </div>
            <div class="form-group">
              <label>K. Mandi</label
              ><input
                type="text"
                id="vKM"
                class="form-control"
                placeholder="2"
              />
            </div>
          </div>
          <div class="form-row-2">
            <div class="form-group">
              <label>Jml Lantai</label
              ><input
                type="text"
                id="vLantai"
                class="form-control"
                placeholder="2"
              />
            </div>
            <div class="form-group">
              <label>Hadap</label
              ><select id="vHadap" class="form-control">
                <option>-</option>
                <option>Utara</option>
                <option>Selatan</option>
                <option>Timur</option>
                <option>Barat</option>
              </select>
            </div>
          </div>
          <div class="form-divider"><span>Kondisi & Legalitas</span></div>
          <div class="form-row-2">
            <div class="form-group">
              <label>Listrik (Watt)</label
              ><input
                type="text"
                id="vListrik"
                class="form-control"
                placeholder="2200"
              />
            </div>
            <div class="form-group">
              <label>Sertifikat</label
              ><select id="vSurat" class="form-control">
                <option>SHM</option>
                <option>HGB</option>
                <option>PPJB</option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label>Kondisi Furnish</label
            ><select id="vFurnish" class="form-control">
              <option>Unfurnished (Kosong)</option>
              <option>Semi Furnished</option>
              <option>Full Furnished</option>
            </select>
          </div>
          <div class="form-divider"><span>Harga Penawaran</span></div>
          <div class="form-group">
            <label>Harga Permintaan (Rp)</label
            ><input
              type="text"
              id="vHarga"
              class="form-control"
              placeholder="Contoh: 3.500.000.000"
              onkeyup="formatRupiahInput(this)"
            />
          </div>
          <button onclick="sendVendorWA()" class="btn-submit-wa">
            <i class="fab fa-whatsapp"></i> Kirim Data Lengkap
          </button>
          <br /><br />
        </div>
      </div>
    </div>

    <div
      id="buyerModal"
      class="detail-modal"
      style="background: #f0f4f8; z-index: 10001;"
    >
      <div class="detail-header">
        <button class="back-btn" onclick="closeBuyerModal()">
          <i class="fas fa-arrow-left"></i>
        </button>
      </div>
      <div class="vendor-content">
        <div class="vendor-title" style="color:#007bff;">
          Bantu Saya Cari Properti
        </div>
        <div
          style="background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);"
        >
          <p style="font-size:12px; color:#666; margin-bottom:15px;">
            Isi kriteria properti yang Anda cari. Saya akan carikan listing
            terbaik (termasuk barang "bawah tangan").
          </p>

          <div class="form-group">
            <label>Nama Anda</label
            ><input
              type="text"
              id="bNama"
              class="form-control"
              placeholder="Nama Lengkap"
            />
          </div>
          <div class="form-group">
            <label>Budget (Kisaran)</label
            ><input
              type="text"
              id="bBudget"
              class="form-control"
              placeholder="Contoh: 2M - 3M"
              onkeyup="formatRupiahInput(this)"
            />
          </div>

          <div class="form-row-2">
            <div class="form-group">
              <label>Area/Lokasi</label
              ><input
                type="text"
                id="bArea"
                class="form-control"
                placeholder="Misal: PIK / Sunter"
              />
            </div>
            <div class="form-group">
              <label>Jenis</label
              ><select id="bJenis" class="form-control">
                <option>Rumah</option>
                <option>Ruko</option>
                <option>Apartemen</option>
                <option>Gudang</option>
                <option>Kavling</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Kebutuhan Khusus (Opsional)</label
            ><textarea
              id="bCatatan"
              class="form-control"
              rows="3"
              placeholder="Contoh: Butuh dekat sekolah, hadap utara, atau untuk investasi."
              style="resize:none; border:1px solid #ddd; border-radius:8px; padding:10px; font-family:inherit; font-size:13px; width:100%;"
            ></textarea>
          </div>

          <button
            onclick="sendBuyerWA()"
            class="btn-submit-wa"
            style="background: #007bff; box-shadow: 0 5px 15px rgba(0,123,255,0.3);"
          >
            <i class="fab fa-whatsapp"></i> Carikan Saya Properti
          </button>
        </div>
      </div>
    </div>

    <div id="lightboxModal" class="lightbox-modal" onclick="closeLightbox()">
      <div class="lightbox-content-wrapper" onclick="event.stopPropagation()">
        <button class="lightbox-close-btn" onclick="closeLightbox()"></button>
        <img id="lightboxImage" src="" class="lightbox-img" />
        <div class="lightbox-hint">Klik di luar foto untuk menutup</div>
      </div>
    </div>

    <button class="btn-scroll-top" id="btnBackTop" onclick="scrollToTop()">
      <i class="fas fa-arrow-up"></i>
    </button>

    <div class="bottom-nav" id="bottomNav">
      <div class="nav-item active" onclick="navClick(this, 'home')">
        <i class="fas fa-home"></i> Home
      </div>
      <div class="nav-item" onclick="navClick(this, 'search')">
        <i class="fas fa-search"></i> Cari
      </div>
      <div class="nav-item" onclick="navClick(this, 'fav')">
        <i class="fas fa-heart"></i> Favorit
      </div>
      <a
        href="https://wa.me/6285760035568"
        target="_blank"
        class="nav-item wa-highlight"
      >
        <i class="fab fa-whatsapp"></i> Hubungi
      </a>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/noUiSlider/15.7.1/nouislider.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

    <script>
      // ==========================================
      // 1. CONFIG SUPABASE & VARIABEL
      // ==========================================
      const SUPABASE_URL = 'https://mpoebxljgdxrogzqscmh.supabase.co'; 
      const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1wb2VieGxqZ2R4cm9nenFzY21oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQwMTIwNTAsImV4cCI6MjA3OTU4ODA1MH0.tIZ0LZtzOXBolwHDsRv6hKRziLO8XrewerM71m-97UQ';

      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

      let properties = [];
      let currentPropId = "";
      let minPriceSliderVal = 0;
      let maxPriceSliderVal = 50000000000;
      let compareIds = [];
      let currentView = 'home'; 

      // ==========================================
      // 2. INIT (SAAT HALAMAN DIMUAT)
      // ==========================================
      window.addEventListener('DOMContentLoaded', async function() {
          // Setup Slider Harga
          var priceSlider = document.getElementById('priceSlider');
          if(priceSlider) {
              noUiSlider.create(priceSlider, {
                  start: [0, 50000000000], connect: true, range: { 'min': 0, 'max': 50000000000 },
                  step: 100000000, format: { to: v => Math.round(v), from: v => Number(v) }
              });

              var minLabel = document.getElementById('price-min-label');
              var maxLabel = document.getElementById('price-max-label');
              const fmtShort = new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', notation: "compact", maximumFractionDigits: 1 });

              priceSlider.noUiSlider.on('update', function (values) {
                  minPriceSliderVal = parseFloat(values[0]);
                  maxPriceSliderVal = parseFloat(values[1]);
                  if(minLabel) minLabel.innerHTML = fmtShort.format(minPriceSliderVal);
                  if(maxLabel) maxLabel.innerHTML = fmtShort.format(maxPriceSliderVal);
                  applyAllFilters();
              });
          }

          await fetchProperties();
      });

      // ==========================================
      // 3. FETCH DATA DARI SUPABASE
      // ==========================================
      async function fetchProperties() {
          const container = document.getElementById('listingContainer');
          let { data, error } = await supabase.from('properties').select('*');

          if (error || !data) {
              console.error("DB Error:", error);
              container.innerHTML = "<div style='text-align:center; padding:20px;'>Gagal memuat data.</div>";
              return;
          }

          // Sanitasi Data
          properties = data.map(item => ({
              ...item,
              id: item.id ? String(item.id).trim() : "unknown",
              title: item.title || "Tanpa Judul",
              price_value: Number(item.price_value) || 0,
              price_old: Number(item.price_old) || 0,
              kt: Number(item.kt) || 0,
              km: Number(item.km) || 0,
              lt: Number(item.lt) || 0,
              lb: Number(item.lb) || 0
          }));

          renderListings(properties, 'listingContainer');
          updateStats();
          renderHistory();

          // Deep Link (Buka detail otomatis jika ada hash di URL)
          if(window.location.hash) {
              let id = window.location.hash.substring(1);
              if(id) setTimeout(() => openDetail(id), 800);
          }
      }

      // ==========================================
      // 4. TOMBOL FAVORIT
      // ==========================================
      function toggleLike(event, id) {
          event.stopPropagation();
          const btn = event.currentTarget;
          
          let favs = JSON.parse(localStorage.getItem('myFavs')) || [];
          let strId = String(id);

          if (favs.includes(strId)) {
              favs = favs.filter(f => f !== strId);
              btn.classList.remove('active'); 
          } else {
              favs.push(strId);
              btn.classList.add('active');
          }
          
          localStorage.setItem('myFavs', JSON.stringify(favs));
          
          if(currentView === 'fav') renderFavorites();
      }

      function renderFavorites() {
          let favs = JSON.parse(localStorage.getItem('myFavs')) || [];
          let favProps = properties.filter(p => favs.includes(String(p.id)));
          
          const container = document.getElementById('favContainer');
          if (favProps.length === 0) {
              container.innerHTML = "<div class='loading-placeholder'>Belum ada properti favorit.</div>";
          } else {
              renderListings(favProps, 'favContainer');
          }
      }

      // ==========================================
      // 5. COMPARE (BANDINGKAN)
      // ==========================================
      function toggleCompare(event, id) {
          event.stopPropagation();
          const btn = event.currentTarget;
          
          if(compareIds.includes(id)) {
             compareIds = compareIds.filter(x => x !== id);
             btn.classList.remove('active');
          } else {
             if(compareIds.length >= 3) {
                alert("Maksimal 3 properti untuk dibandingkan.");
                return;
             }
             compareIds.push(id);
             btn.classList.add('active');
          }
          updateCompareUI();
      }

      function updateCompareUI() {
          let bar = document.getElementById('compareBar');
          document.getElementById('compareCount').innerText = compareIds.length;
          
          if(compareIds.length > 0) bar.classList.add('show');
          else bar.classList.remove('show');
      }

      function clearCompare() {
          compareIds = [];
          updateCompareUI();
          document.querySelectorAll('.btn-compare').forEach(b => b.classList.remove('active'));
      }

      function openCompareModal() {
          if(compareIds.length < 2) {
              alert("Pilih minimal 2 properti untuk dibandingkan.");
              return;
          }
          
          let props = compareIds.map(id => properties.find(p => String(p.id) === String(id))).filter(Boolean);
          let table = document.getElementById('compareTableContent');
          
          let html = `<tr><td class="compare-label">Foto</td>`;
          props.forEach(p => {
              let img = p.images ? p.images.split(';')[0] : '';
              html += `<td class="compare-val"><img src="${img}" class="compare-header-img"><div style="font-weight:700; font-size:11px;">${p.title}</div><div style="color:#d63031; font-weight:800; margin-top:5px;">${p.price_display}</div></td>`;
          });
          html += `</tr>`;

          // Fields to compare
          let fields = [
              {l:'Lokasi', k:'location'}, {l:'LT', k:'lt'}, {l:'LB', k:'lb'},
              {l:'K.Tidur', k:'kt'}, {l:'K.Mandi', k:'km'}, {l:'Lantai', k:'lantai'},
              {l:'Listrik', k:'listrik'}, {l:'Hadap', k:'hadap'}, {l:'Surat', k:'surat'}
          ];

          fields.forEach(f => {
              html += `<tr><td class="compare-label">${f.l}</td>`;
              props.forEach(p => html += `<td class="compare-val">${p[f.k] || '-'}</td>`);
              html += `</tr>`;
          });

          table.innerHTML = html;
          document.getElementById('compareModal').classList.add('active');
      }
      
      function closeCompareModal() {
          document.getElementById('compareModal').classList.remove('active');
      }

      // ==========================================
      // 6. BOOKING SURVEY & CALENDAR
      // ==========================================
      async function sendBookingWA() {
          let date = document.getElementById('bookDate').value;
          let time = document.getElementById('bookTime').value;
          let name = document.getElementById('bookName').value;
          let btn = document.getElementById('btnSendBooking');

          if(!date || !time || !name) { 
              alert("Mohon lengkapi Tanggal, Jam, dan Nama Anda!"); 
              return; 
          }

          let prop = properties.find(p => String(p.id) === currentPropId);
          if(!prop) { alert("Data properti error."); return; }

          btn.innerHTML = "<i class='fas fa-spinner fa-spin'></i> Mengirim...";
          btn.disabled = true;

          // Simpan ke Supabase agar masuk Kalender
          const { error } = await supabase.from('bookings').insert([{ 
                  property_id: prop.id, 
                  property_title: prop.title,
                  client_name: name,
                  date: date,
                  time: time,
                  created_at: new Date()
          }]);

          if (error) console.error("Gagal simpan booking DB:", error);

          // Kirim ke WA
          let msg = `Halo Pak Herman, saya ingin *BOOKING SURVEY LOKASI*:%0A%0A Properti: ${prop.title}%0A Tanggal: ${date}%0A Jam: ${time}%0A Nama: ${name}%0A%0AMohon konfirmasi ketersediaan jadwal. Terima kasih.`;
          
          window.open(`https://wa.me/6285760035568?text=${msg}`, '_blank');
          
          closeBooking();
          btn.innerHTML = "Kirim Jadwal via WA";
          btn.disabled = false;
      }

      async function openCalendar() {
          document.getElementById('calendarModal').classList.add('active');
          const list = document.getElementById('calendarList');
          list.innerHTML = "<div style='text-align:center; color:white; margin-top:50px;'><i class='fas fa-spinner fa-spin'></i> Memuat jadwal...</div>";

          // Ambil data booking dari Supabase
          const { data, error } = await supabase
              .from('bookings')
              .select('*')
              .order('date', { ascending: true });

          if(error || !data || data.length === 0) {
              list.innerHTML = "<div style='text-align:center; color:white; margin-top:50px;'>Belum ada jadwal survey.</div>";
              return;
          }

          list.innerHTML = "";
          const months = ["JAN", "FEB", "MAR", "APR", "MEI", "JUN", "JUL", "AGU", "SEP", "OKT", "NOV", "DES"];

          data.forEach(item => {
              let d = new Date(item.date);
              let dateNum = d.getDate();
              let monthName = months[d.getMonth()];
              let isPast = new Date() > new Date(item.date + 'T23:59:00');
              
              let html = `
              <div class="calendar-card" style="opacity: ${isPast ? 0.6 : 1}">
                  <div class="cc-left">
                      <span class="cc-date">${dateNum}</span>
                      <span class="cc-month">${monthName}</span>
                  </div>
                  <div class="cc-right">
                      <span class="cc-badge ${isPast ? 'internal' : 'umum'}">${isPast ? 'Selesai' : 'Upcoming'}</span>
                      <div class="cc-title">${item.property_title}</div>
                      <div class="cc-time"><i class="far fa-clock"></i> ${item.time} WIB  ${item.client_name}</div>
                  </div>
              </div>`;
              list.insertAdjacentHTML('beforeend', html);
          });
      }

      function closeCalendar() { document.getElementById('calendarModal').classList.remove('active'); }

      // ==========================================
      // 7. RENDER LISTING & DETAIL
      // ==========================================
      function renderListings(data, containerId) {
        const container = document.getElementById(containerId);
        container.innerHTML = "";

        if(!data || data.length === 0) {
            container.innerHTML = "<div class='no-result' style='display:block'>Tidak ada data properti.</div>";
            return;
        }

        let favs = JSON.parse(localStorage.getItem('myFavs')) || [];

        data.forEach(prop => {
            let firstImg = (prop.images && prop.images.length > 5) ? prop.images.split(';')[0] : 'https://placehold.co/400x300?text=No+Image';
            let isFav = favs.includes(String(prop.id));
            let isCompare = compareIds.includes(String(prop.id));
            let isHot = (prop.category || '').toLowerCase().includes('hot');
            
            let rawStatus = (prop.status || '').toLowerCase();
            let statusColorClass = (rawStatus.includes('sewa') && !rawStatus.includes('jual')) ? 'sewa' : 'jual';
            let badgeHtml = isHot ? '<span class="hot-deal-badge">Hot Deal</span>' : '';

            let priceHtml = `<div class="price-tag">${prop.price_display || "Hubungi Agen"}</div>`;
            if(prop.price_rent) {
                 priceHtml = `<div class="price-tag">${prop.price_display}</div><div style="font-size:10px; color:#007bff; font-weight:600; margin-top:-2px;">Sewa: ${prop.price_rent}</div>`;
            }

            let html = `
            <div class="property-card ${rawStatus} ${isHot?'hot':''}" id="card-${prop.id}" onclick="openDetail('${String(prop.id)}')"
                 data-price-val="${prop.price_value}"
                 data-type="${(prop.type||'').toLowerCase()}"
                 data-kt="${prop.kt}">
                <div class="card-image-wrapper">
                    <div class="badge-top-left"><span class="status-tag ${statusColorClass}">${prop.status}</span>${badgeHtml}</div>
                    <button class="btn-wishlist ${isFav ? 'active' : ''}" onclick="toggleLike(event, '${String(prop.id)}')"><i class="fas fa-heart"></i></button>
                    <button class="btn-compare ${isCompare ? 'active' : ''}" onclick="toggleCompare(event, '${String(prop.id)}')"><i class="fas fa-exchange-alt"></i></button>
                    <img src="${firstImg}" class="card-img" loading="lazy" onerror="this.src='https://placehold.co/400x300?text=Image+Error'">
                </div>
                <div class="card-body">
                    <div>${priceHtml}<div class="prop-name">${prop.title}</div><div class="location-row"><i class="fas fa-map-marker-alt"></i> ${prop.location}</div><div class="specs-row"><span class="spec-item"><i class="fas fa-bed"></i> ${prop.kt}</span><span class="spec-item"><i class="fas fa-bath"></i> ${prop.km}</span><span class="spec-item"><i class="fas fa-expand"></i> ${prop.lt}</span></div></div>
                    <div class="card-btn">Lihat Detail</div>
                </div>
            </div>`;
            container.insertAdjacentHTML('beforeend', html);
        });
      }

      function openDetail(id) {
          const data = properties.find(p => String(p.id).toLowerCase() === String(id).trim().toLowerCase());
          if(!data) return;
          
          currentPropId = String(data.id); 
          addToHistory(currentPropId);

          // Logic Harga Ganda (Jual & Sewa)
          let hJual = data.price_display;
          let hSewa = data.price_rent;
          let priceDisplay = "";
          
          if(hJual && hSewa) {
              priceDisplay = `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;"><span style="font-size:20px; font-weight:bold;">${hJual}</span><span style="color:#007bff; font-weight:bold;">Sewa: ${hSewa}</span></div>`;
          } else if(hSewa && !hJual) {
              priceDisplay = `<div class="d-price" style="color:#007bff">${hSewa} <span style="font-size:12px; font-weight:400; color:#666;">(Sewa)</span></div>`;
          } else {
              priceDisplay = `<div class="d-price">${hJual || hSewa || ""}</div>`;
          }

          document.getElementById('dPrice').innerHTML = priceDisplay;
          document.getElementById('dTitle').textContent = data.title;
          document.getElementById('dLoc').textContent = data.location;
          
          ['kt','km','lt','lb','lantai','hadap','listrik','surat'].forEach(key => {
              let el = document.getElementById('d'+key.toUpperCase()) || document.getElementById('d'+key.charAt(0).toUpperCase() + key.slice(1));
              if(el) el.textContent = data[key] || '-';
          });
          document.getElementById('dDesc').textContent = data.desc || 'Tidak ada deskripsi.';

          // Gallery
          const gallery = document.getElementById('detailGallery');
          gallery.innerHTML = "";
          if(data.images) {
              data.images.split(';').forEach(url => {
                  if(url.trim()) gallery.innerHTML += `<img src="${url.trim()}" class="gallery-img" onclick="openLightbox(this.src)">`;
              });
          }

          // Facilities
          const facList = document.getElementById('dFac');
          facList.innerHTML = "";
          if(data.facilities) {
              data.facilities.split(';').forEach(f => {
                  if(f.trim()) facList.innerHTML += `<div class="fac-item"><i class="fas fa-check-circle"></i> ${f.trim()}</div>`;
              });
          }

          // Nearby
          let nearbyDiv = document.getElementById('nearbySection');
          let nearbyContainer = document.getElementById('nearbyContainer');
          nearbyContainer.innerHTML = "";
          if(data.nearby) {
              data.nearby.split(';').forEach(n => {
                  let icon = 'fa-map-marker-alt';
                  let t = n.trim().toLowerCase();
                  if(t.includes('mall')||t.includes('plaza')) icon='fa-shopping-cart';
                  else if(t.includes('tol')||t.includes('jalan')) icon='fa-road';
                  else if(t.includes('sekolah')||t.includes('univ')) icon='fa-graduation-cap';
                  else if(t.includes('rs')||t.includes('sakit')) icon='fa-hospital';
                  
                  if(n.trim()) nearbyContainer.innerHTML += `<div class="nearby-tag"><i class="fas ${icon}"></i> ${n.trim()}</div>`;
              });
              nearbyDiv.style.display = 'block';
          } else {
              nearbyDiv.style.display = 'none';
          }

          // Video
          let videoBox = document.getElementById('videoBox');
          let videoContainer = document.getElementById('videoContainer');
          if(data.video_url && data.video_url.length > 10) {
              let embedUrl = data.video_url.replace("youtu.be/", "youtube.com/embed/").replace("watch?v=", "embed/");
              videoContainer.innerHTML = `<iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>`;
              videoBox.style.display = "block";
          } else {
              videoBox.style.display = "none";
          }

          document.getElementById('detailModal').classList.add('active');
          document.body.style.overflow = 'hidden';
          history.pushState(null, null, `#${data.id}`);
          
          renderSimilarProperties(data);
      }

      function closeDetail() { 
          document.getElementById('detailModal').classList.remove('active'); 
          document.body.style.overflow = 'auto'; 
          history.pushState(null, null, ' '); 
      }

      // ==========================================
      // 8. FILTER & UTILS
      // ==========================================
      function applyAllFilters() {
          if(currentView !== 'search') return;
          let txt = document.getElementById("searchInput").value.toLowerCase();
          let activeBtn = document.querySelector("#viewSearch .filter-btn.active");
          let filterCat = activeBtn ? activeBtn.textContent.toLowerCase() : "semua";
          let typeVal = document.getElementById('typeFilter').value;
          let ktVal = parseInt(document.getElementById('ktFilter').value) || 0;
          let suratVal = document.getElementById('suratFilter').value;
          let furnVal = document.getElementById('furnishFilter').value;

          let searchResultIds = null;
          if (txt.trim() !== "") {
              const fuse = new Fuse(properties, { keys: ['title', 'location', 'type'], threshold: 0.4 });
              searchResultIds = fuse.search(txt).map(res => String(res.item.id));
          }

          let cards = document.querySelectorAll("#listingContainer .property-card");
          let found = 0;

          cards.forEach(c => {
              let show = true;
              let pId = c.id.replace('card-', '');
              let pType = c.getAttribute('data-type');
              let pKt = parseInt(c.getAttribute('data-kt')) || 0;
              
              if(searchResultIds && !searchResultIds.includes(pId)) show = false;
              if(filterCat.includes("dijual") && !c.classList.contains('jual')) show = false;
              if(filterCat.includes("disewa") && !c.classList.contains('sewa')) show = false;
              if(filterCat.includes("hot") && !c.classList.contains('hot')) show = false;
              
              // Advanced Filters
              if(typeVal !== 'all' && !pType.includes(typeVal)) show = false;
              if(ktVal > 0 && pKt < ktVal) show = false;
              
              let pVal = parseFloat(c.getAttribute('data-price-val')) || 0;
              if(pVal < minPriceSliderVal || pVal > maxPriceSliderVal) show = false;

              c.style.display = show ? "flex" : "none";
              if(show) found++;
          });
          
          let nr = document.querySelector('#viewSearch .no-result');
          if(nr) nr.style.display = found === 0 ? 'block' : 'none';
      }

      function navClick(el, target) {
          if(el) {
              document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
              if(!el.classList.contains('wa-highlight')) el.classList.add('active');
          }
          document.querySelectorAll('.view-section').forEach(v => v.classList.remove('active'));
          scrollToTop();

          if (target === 'home') { document.getElementById('viewHome').classList.add('active'); currentView = 'home'; }
          else if (target === 'search') { document.getElementById('viewSearch').classList.add('active'); currentView = 'search'; applyAllFilters(); }
          else if (target === 'fav') { document.getElementById('viewFav').classList.add('active'); currentView = 'fav'; renderFavorites(); }
      }

      function renderSimilarProperties(currentProp) {
          let container = document.getElementById('similarList'); 
          let section = document.getElementById('similarSection');
          container.innerHTML = "";
          let similar = properties.filter(p => String(p.id) !== String(currentProp.id) && (p.type === currentProp.type || Math.abs(p.price_value - currentProp.price_value) < 500000000)).slice(0,4);
          
          if(similar.length === 0) { section.style.display = 'none'; return; }
          section.style.display = 'block';
          similar.forEach(p => {
              let img = (p.images) ? p.images.split(';')[0] : '';
              container.insertAdjacentHTML('beforeend', `<div class="similar-card" onclick="openDetail('${p.id}')"><img src="${img}" class="similar-img"><div class="similar-body"><div class="similar-price">${p.price_display}</div><div class="similar-title">${p.title}</div></div></div>`);
          });
      }

      function addToHistory(id) {
          let h = JSON.parse(localStorage.getItem('viewHistory')) || [];
          h = h.filter(x => x !== id); h.unshift(id);
          if(h.length > 10) h.pop();
          localStorage.setItem('viewHistory', JSON.stringify(h));
          renderHistory();
      }

      function renderHistory() {
          let h = JSON.parse(localStorage.getItem('viewHistory')) || [];
          let props = h.map(id => properties.find(p => String(p.id) === id)).filter(Boolean);
          let container = document.getElementById('historyList');
          let section = document.getElementById('historySection');
          container.innerHTML = "";
          if(props.length === 0) { section.style.display='none'; return; }
          section.style.display='block';
          props.forEach(p => {
              let img = (p.images) ? p.images.split(';')[0] : '';
              container.insertAdjacentHTML('beforeend', `<div class="similar-card" onclick="openDetail('${p.id}')"><img src="${img}" class="similar-img"><div class="similar-body"><div class="similar-price">${p.price_display}</div><div class="similar-title">${p.title}</div></div></div>`);
          });
      }

      // ==========================================
      // FUNGSI UMUM LAINNYA
      // ==========================================
      function clickStatBaru(cat) { 
          navClick(null, 'search'); 
          
          // Reset tombol filter
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          // Cari tombol yg sesuai textnya
          let btns = document.querySelectorAll('.filter-btn');
          for(let btn of btns) {
              if(btn.textContent.toLowerCase().includes(cat)) {
                  btn.classList.add('active'); break;
              }
          }
          if(cat==='all') btns[0].classList.add('active');

          document.getElementById('filterArea').scrollIntoView({behavior:'smooth'}); 
          applyAllFilters(); 
      }

      function resetAllFilters() { 
          document.getElementById('searchInput').value=''; 
          document.getElementById('priceSlider').noUiSlider.reset(); 
          document.getElementById('typeFilter').value = 'all';
          document.getElementById('ktFilter').value = '0';
          applyAllFilters(); 
      }
      
      function sortListings() { 
          let sortVal = document.getElementById('sortSelect').value;
          // Sorting logic sederhana pada array properties sebelum render ulang (opsional)
          // Di sini kita hanya panggil applyAllFilters, sorting idealnya memanipulasi DOM order
          let container = document.getElementById('listingContainer');
          let cards = Array.from(container.children);
          
          cards.sort((a, b) => {
              let pA = parseFloat(a.getAttribute('data-price-val')) || 0;
              let pB = parseFloat(b.getAttribute('data-price-val')) || 0;
              if(sortVal === 'price-high') return pB - pA;
              if(sortVal === 'price-low') return pA - pB;
              return 0; 
          });
          
          if(sortVal !== 'newest') {
             cards.forEach(card => container.appendChild(card));
          } else {
             // Kalau newest, render ulang saja dari fetch awal (properties biasanya sudah urut ID)
             renderListings(properties, 'listingContainer');
          }
          applyAllFilters();
      }

      function updateStats() { document.getElementById('countAll').innerText = properties.length; document.getElementById('countJual').innerText = properties.filter(p=>(p.status||'').toLowerCase().includes('jual')).length; document.getElementById('countSewa').innerText = properties.filter(p=>(p.status||'').toLowerCase().includes('sewa')).length; }
      
      function openBooking() { document.getElementById('bookingModal').classList.add('active'); }
      function closeBooking() { document.getElementById('bookingModal').classList.remove('active'); }
      function validateSchedule() { /* Optional validation */ }
      function openVendorModal() { document.getElementById('vendorModal').classList.add('active'); }
      function closeVendorModal() { document.getElementById('vendorModal').classList.remove('active'); }
      function sendVendorWA() { let v=id=>document.getElementById(id).value; window.open(`https://wa.me/6285760035568?text=Titip Listing:%0A${v('vNama')}%0A${v('vLokasi')}`, '_blank'); }
      function openBuyerModal() { document.getElementById('buyerModal').classList.add('active'); }
      function closeBuyerModal() { document.getElementById('buyerModal').classList.remove('active'); }
      function sendBuyerWA() { let v=id=>document.getElementById(id).value; window.open(`https://wa.me/6285760035568?text=Cari Properti:%0A${v('bNama')}%0AArea: ${v('bArea')}`, '_blank'); }
      
      function shareFavoritesWA() { let favs = JSON.parse(localStorage.getItem('myFavs')) || []; if(favs.length===0){ alert("Kosong"); return; } window.open(`https://wa.me/6285760035568?text=Saya suka ${favs.length} properti Anda.`, '_blank'); }
      
      // ==========================================
      // KPR, BUDGET & PAJAK LOGIC (FIXED)
      // ==========================================
      function switchKprTab(t) { 
          document.querySelectorAll('.kpr-tab-btn').forEach(b => b.classList.remove('active'));
          event.target.classList.add('active');
          document.querySelectorAll('.kpr-content').forEach(c => c.style.display='none');
          if(t==='cicilan') document.getElementById('tabCicilan').style.display='block';
          if(t==='budget') document.getElementById('tabBudget').style.display='block';
          if(t==='pajak') document.getElementById('tabPajak').style.display='block';
      }
      function formatRupiahInput(e) { 
          let val = e.value.replace(/[^0-9]/g, '');
          e.value = new Intl.NumberFormat('id-ID').format(val);
      }

      function hitungKPR() {
          let h = parseFloat(document.getElementById('kprHarga').value.replace(/\./g,'')) || 0;
          let dpP = parseFloat(document.getElementById('kprDP').value) || 0;
          let bunga = parseFloat(document.getElementById('kprBunga').value) || 0;
          let ten = parseFloat(document.getElementById('kprTahun').value) || 0;
          
          let dpNom = h * (dpP/100);
          let pokok = h - dpNom;
          let bbln = (bunga/100)/12;
          let bln = ten * 12;
          
          let angsuran = (pokok * bbln) / (1 - Math.pow(1+bbln, -bln));
          
          document.getElementById('outPokok').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(pokok);
          document.getElementById('outCicilan').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(angsuran));
          document.getElementById('outGaji').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(angsuran * 3));
          document.getElementById('hasilKPR').style.display = 'block';
      }

      function hitungBudgetKPR() {
          let gaji = parseFloat(document.getElementById('budGaji').value.replace(/\./g,'')) || 0;
          let persen = parseFloat(document.getElementById('budPersen').value) || 30;
          let dp = parseFloat(document.getElementById('budDP').value.replace(/\./g,'')) || 0;
          let bunga = parseFloat(document.getElementById('budBunga').value) || 5;
          let ten = parseFloat(document.getElementById('budTahun').value) || 15;

          // Kemampuan Cicilan Bulanan
          let maxCicilan = gaji * (persen / 100);

          // Hitung Max Pinjaman (PV Formula)
          let r = (bunga / 100) / 12;
          let n = ten * 12;
          let maxPinjaman = maxCicilan * (1 - Math.pow(1 + r, -n)) / r;

          // Max Harga Properti
          let maxHarga = maxPinjaman + dp;

          document.getElementById('outBudCicilan').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(maxCicilan));
          document.getElementById('outBudPinjaman').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(maxPinjaman));
          document.getElementById('outBudMaxHarga').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(maxHarga));
          document.getElementById('hasilBudget').style.display = 'block';
      }

      function hitungPajak() {
          let harga = parseFloat(document.getElementById('pajakHarga').value.replace(/\./g,'')) || 0;
          let npoptkp = parseFloat(document.getElementById('pajakNPOPTKP').value.replace(/\./g,'')) || 0;
          let persenNotaris = parseFloat(document.getElementById('pajakPersenNotaris').value) || 0;

          // BPHTB: (Harga - NPOPTKP) x 5%
          let dasarPajak = harga - npoptkp;
          if (dasarPajak < 0) dasarPajak = 0;
          let bphtb = dasarPajak * 0.05;

          // Notaris
          let notaris = harga * (persenNotaris / 100);
          
          let total = bphtb + notaris;

          document.getElementById('outBPHTB').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(bphtb));
          document.getElementById('outNotaris').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(notaris));
          document.getElementById('outTotalPajak').innerText = "Rp " + new Intl.NumberFormat('id-ID').format(Math.round(total));
          document.getElementById('hasilPajak').style.display = 'block';
      }

      function shareKPRToWA() { 
          // Simple sharing text
          let txt = "Halo, saya baru hitung simulasi KPR di website Herman Kosasi. Hasilnya menarik.";
          window.open(`https://wa.me/6285760035568?text=${txt}`, '_blank');
      }

      function shareListing() {
          if(navigator.share) {
              navigator.share({ title: document.getElementById('dTitle').textContent, text: 'Cek properti ini: ' + document.getElementById('dTitle').textContent, url: window.location.href });
          } else {
              alert("Link disalin!");
          }
      }

      function openLightbox(src) { document.getElementById('lightboxImage').src = src; document.getElementById('lightboxModal').classList.add('active'); }
      function closeLightbox() { document.getElementById('lightboxModal').classList.remove('active'); }
      function toggleFaq(btn) { btn.parentElement.classList.toggle('active'); }
      function scrollToTop() { window.scrollTo({top:0, behavior:'smooth'}); }
      
      // POSTER GENERATOR
      function generatePoster() {
          const data = properties.find(p => String(p.id) === currentPropId);
          if(!data) return;
          
          let imgUrl = (data.images) ? data.images.split(';')[0] : '';
          document.getElementById('posterMainImg').src = imgUrl;
          document.getElementById('posterMainImg').crossOrigin = "Anonymous";
          
          document.getElementById('posterPrice').innerText = data.price_display;
          document.getElementById('posterTitle').innerText = data.title;
          document.getElementById('posterLoc').innerText = data.location;
          document.getElementById('posterKT').innerText = data.kt;
          document.getElementById('posterKM').innerText = data.km;
          document.getElementById('posterLT').innerText = data.lt;
          
          document.body.style.cursor = 'wait';
          setTimeout(() => {
              const el = document.getElementById("posterTemplate");
              el.style.left = "0px";
              html2canvas(el, { useCORS: true, scale: 2, allowTaint: true }).then(canvas => {
                  el.style.left = "-9999px";
                  document.body.style.cursor = 'default';
                  const link = document.createElement('a');
                  link.download = `Poster-${data.id}.png`;
                  link.href = canvas.toDataURL("image/png");
                  link.click();
              }).catch(e => { alert("Gagal membuat poster. Coba screenshot manual."); el.style.left="-9999px"; document.body.style.cursor='default'; });
          }, 1000);
      }

      window.onscroll = function() { 
          let btn = document.getElementById("btnBackTop"); 
          if(btn) {
              if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) btn.classList.add("show"); 
              else btn.classList.remove("show"); 
          }
      };
    </script>
  </body>
</html>
